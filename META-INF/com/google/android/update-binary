#!/sbin/sh
###FeraLab###
FD=$2
ZIP=$3
set -o pipefail
ui_print() {
  echo -n -e "ui_print $1\n" > /proc/self/fd/$FD
  echo -n -e "ui_print\n" > /proc/self/fd/$FD
}
ui_print ""
ui_print ""
ui_print "***FeraLab***"
ui_print "FeraDroid Engine v0.19-beta8"
ui_print ""
ui_print "FDE deploy.."
mount /system
mount -o rw,remount /system
mount -o rw,remount /system /system
mount -o rw,remount /
mount -o rw,remount / /
mkdir /fde
unzip "$ZIP" -d /fde
chmod 755 /fde/system/engine/bin/*
chmod 755 /fde/system/engine/*
export PATH=$PATH:/fde/system/engine/bin
rm -Rf /system/engine/*
rm -Rf /system/etc/init.d/*
rm -f /sdcard/Android/FDE.txt
unzip -o "$ZIP"
chmod -R 755 /system/engine
chmod -R 755 /system/engine/*
chmod -R 755 /system/engine/assets/*
chmod -R 755 /system/engine/bin/*
chmod -R 755 /system/engine/gears/*
chmod -R 755 /system/engine/prop/*
chmod -R 755 /system/etc/init.d/*
/system/engine/bin/busybox --install -s /system/xbin
/system/engine/as.sh
rm -Rf /fde/*
umount /system
ui_print ""
ui_print ""
ui_print "FDE injected."
ui_print "By FeraVolt. 2016."
exit 0
